// Generated by CoffeeScript 1.7.1
var Future, path, pathToCore, requirejs, _requirejsReady;

path = require('path');

requirejs = require('requirejs');

Future = require('../../utils/Future');

pathToCore = 'bundles/cord/core';

_requirejsReady = null;

module.exports = function(task) {

  /*
  First call initiates cordjs framework requirejs configuration (paths and so on).
  Returns a future which completes when requirejs is configured.
  All subsequent calls returns the same future.
  @param Object task params to take base and target directories from
  @return Future[Nothing]
   */
  var pathConfig;
  if (_requirejsReady == null) {
    pathConfig = require("" + (path.join(task.targetDir, 'public', pathToCore)) + "/requirejs/pathConfig");
    requirejs.config({
      baseUrl: "" + task.targetDir + "/public",
      nodeRequire: require,
      paths: pathConfig
    });
    _requirejsReady = Future.require('pathUtils').map((function(_this) {
      return function(pathUtils) {
        return pathUtils.setPublicPrefix('target/public');
      };
    })(this));
  }
  return _requirejsReady;
};
