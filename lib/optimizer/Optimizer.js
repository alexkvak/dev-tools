// Generated by CoffeeScript 1.6.3
var CorrelationGroupDetector, GroupRepo, HeuristicGroupDetector, Optimizer, fs;

fs = require('fs');

CorrelationGroupDetector = require('./CorrelationGroupDetector');

GroupRepo = require('./GroupRepo');

HeuristicGroupDetector = require('./HeuristicGroupDetector');

Optimizer = (function() {
  function Optimizer() {}

  Optimizer.prototype.run = function() {
    var statFile,
      _this = this;
    statFile = 'require-stat.json';
    return fs.readFile(statFile, function(err, data) {
      var stat;
      stat = err ? {} : JSON.parse(data);
      return console.log(JSON.stringify(_this.generateOptimizationMap(stat), null, 2));
    });
  };

  Optimizer.prototype.generateOptimizationMap = function(stat) {
    var corrDetector, groupRepo, heuristicDetector, iterations;
    iterations = 1;
    groupRepo = new GroupRepo;
    while (iterations--) {
      corrDetector = new CorrelationGroupDetector(groupRepo);
      stat = corrDetector.process(stat);
      heuristicDetector = new HeuristicGroupDetector(groupRepo);
      stat = heuristicDetector.process(stat);
    }
    return stat;
  };

  return Optimizer;

})();

module.exports = Optimizer;
